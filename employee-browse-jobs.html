<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkedIn - Browse Jobs</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f5ed;
            color: #333;
        }

        .header {
            background: #ffffff;
            border-bottom: 1px solid #e0d9c7;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 2rem;
            font-weight: bold;
            color: #b0a080;
            text-decoration: none;
        }

        .nav {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-item {
            color: #666;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .nav-item:hover {
            color: #b0a080;
        }

        .nav-item.active {
            color: #b0a080;
        }

        .main {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .search-section {
            background: #ffffff;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }

        .search-bar {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .search-input {
            flex: 1;
            padding: 0.8rem;
            border: 1px solid #e0d9c7;
            border-radius: 8px;
            font-size: 1rem;
        }

        .search-btn {
            background: #b0a080;
            color: white;
            border: none;
            padding: 0.8rem 2rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s ease;
        }

        .search-btn:hover {
            background: #9a8c6c;
        }

        .filters {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .filter-select {
            padding: 0.5rem 1rem;
            border: 1px solid #e0d9c7;
            border-radius: 8px;
            background: #ffffff;
            cursor: pointer;
        }

        .jobs-container {
            display: grid;
            gap: 1.5rem;
        }

        .job-card {
            background: #ffffff;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .job-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .job-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .job-title {
            font-size: 1.4rem;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .company-name {
            color: #666;
            font-size: 1.1rem;
        }

        .company-logo {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            background: #f8f5ed;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .job-details {
            display: flex;
            gap: 1.5rem;
            margin: 1rem 0;
            color: #666;
            font-size: 0.95rem;
            flex-wrap: wrap;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .job-description {
            color: #666;
            line-height: 1.6;
            margin: 1rem 0;
        }

        .skills-list {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin: 1rem 0;
        }

        .skill-tag {
            background: #f8f5ed;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.85rem;
            color: #666;
        }

        .job-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e0d9c7;
        }

        .posted-time {
            color: #999;
            font-size: 0.9rem;
        }

        .apply-btn {
            background: #b0a080;
            color: white;
            border: none;
            padding: 0.6rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s ease;
        }

        .apply-btn:hover {
            background: #9a8c6c;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            background: #ffffff;
            border-radius: 12px;
        }

        .job-details-expanded {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e0d9c7;
            display: none;
        }

        .job-details-expanded.show {
            display: block;
        }

        @media (max-width: 768px) {
            .header {
                padding: 1rem;
            }
            
            .nav {
                gap: 1rem;
                flex-wrap: wrap;
            }
            
            .search-bar {
                flex-direction: column;
            }
            
            .job-header {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <a href="index.html" class="logo">in</a>
        <nav class="nav">
            <a href="employee-home.html" class="nav-item">Home</a>
            <a href="employee-browse-jobs.html" class="nav-item active">Jobs</a>
            <a href="employee-my-applications.html" class="nav-item">My Applications</a>
            <a href="/networks.html" class="nav-item">Network</a>
            <a href="index.html" class="nav-item">Logout</a>
        </nav>
    </header>

    <main class="main">
        <div class="search-section">
            <div class="search-bar">
                <input type="text" id="searchInput" class="search-input" placeholder="Search for jobs, companies, or keywords...">
                <button class="search-btn" onclick="searchJobs()">Search</button>
            </div>
            <div class="filters">
                <select class="filter-select" id="locationFilter" onchange="applyFilters()">
                    <option value="">All Locations</option>
                    <option value="remote">Remote</option>
                    <option value="on-site">On-site</option>
                    <option value="hybrid">Hybrid</option>
                </select>
                <select class="filter-select" id="typeFilter" onchange="applyFilters()">
                    <option value="">All Job Types</option>
                    <option value="full-time">Full-time</option>
                    <option value="part-time">Part-time</option>
                    <option value="contract">Contract</option>
                    <option value="internship">Internship</option>
                </select>
                <select class="filter-select" id="experienceFilter" onchange="applyFilters()">
                    <option value="">All Experience Levels</option>
                    <option value="entry-level">Entry Level</option>
                    <option value="associate">Associate</option>
                    <option value="mid-senior">Mid-Senior</option>
                    <option value="director">Director</option>
                    <option value="executive">Executive</option>
                </select>
            </div>
        </div>

        <div id="loadingState" class="loading">
            Loading jobs...
        </div>

        <div id="jobsContainer" class="jobs-container" style="display: none;">
            <!-- Jobs will be loaded here -->
        </div>

        <div id="emptyState" class="empty-state" style="display: none;">
            <h3>No jobs found</h3>
            <p>Try adjusting your search or filters</p>
        </div>
    </main>

    <script>
        const token = localStorage.getItem('token');
        const user = JSON.parse(localStorage.getItem('user') || '{}');
        let allJobs = [];

        // Load jobs on page load
        document.addEventListener('DOMContentLoaded', loadJobs);

        async function loadJobs() {
            try {
                const response = await fetch('/api/jobs');
                const data = await response.json();
                console.log('Jobs loaded:', data);

                if (response.ok && data.jobs) {
                    allJobs = data.jobs;
                    displayJobs(allJobs);
                    
                    document.getElementById('loadingState').style.display = 'none';
                    
                    if (allJobs.length === 0) {
                        document.getElementById('emptyState').style.display = 'block';
                    } else {
                        document.getElementById('jobsContainer').style.display = 'grid';
                    }
                } else {
                    throw new Error(data.error || 'Failed to load jobs');
                }
            } catch (error) {
                console.error('Error loading jobs:', error);
                document.getElementById('loadingState').innerHTML = `
                    <p style="color: #d32f2f;">Failed to load jobs. Please try again.</p>
                `;
            }
        }

        function displayJobs(jobs) {
            const container = document.getElementById('jobsContainer');
            
            if (jobs.length === 0) {
                document.getElementById('emptyState').style.display = 'block';
                container.style.display = 'none';
                return;
            }

            document.getElementById('emptyState').style.display = 'none';
            container.style.display = 'grid';

            container.innerHTML = jobs.map(job => `
                <div class="job-card" id="job-${job._id}">
                    <div class="job-header">
                        <div style="flex: 1;">
                            <h3 class="job-title">${job.title}</h3>
                            <p class="company-name">${job.company}</p>
                        </div>
                        <div class="company-logo">🏢</div>
                    </div>
                    
                    <div class="job-details">
                        <span class="detail-item">📍 ${job.location}</span>
                        <span class="detail-item">💼 ${formatEmploymentType(job.employmentType)}</span>
                        <span class="detail-item">📊 ${formatExperienceLevel(job.experienceLevel)}</span>
                        ${job.workplaceType ? `<span class="detail-item">🏠 ${formatWorkplaceType(job.workplaceType)}</span>` : ''}
                    </div>
                    
                    <p class="job-description">${truncateText(job.description, 150)}</p>
                    
                    ${job.skills && job.skills.length > 0 ? `
                        <div class="skills-list">
                            ${job.skills.slice(0, 5).map(skill => `<span class="skill-tag">${skill}</span>`).join('')}
                            ${job.skills.length > 5 ? `<span class="skill-tag">+${job.skills.length - 5} more</span>` : ''}
                        </div>
                    ` : ''}
                    
                    <div class="job-footer">
                        <span class="posted-time">Posted ${formatDate(job.createdAt)}</span>
                        <button class="apply-btn" onclick="applyToJob('${job._id}', '${job.title}')">Apply Now</button>
                    </div>
                    
                    <div class="job-details-expanded" id="details-${job._id}">
                        <p><strong>Full Description:</strong></p>
                        <p>${job.description}</p>
                        ${job.requirements && job.requirements.length > 0 ? `
                            <p style="margin-top: 1rem;"><strong>Requirements:</strong></p>
                            <ul style="margin-left: 1.5rem;">
                                ${job.requirements.map(req => `<li>${req}</li>`).join('')}
                            </ul>
                        ` : ''}
                        ${job.responsibilities && job.responsibilities.length > 0 ? `
                            <p style="margin-top: 1rem;"><strong>Responsibilities:</strong></p>
                            <ul style="margin-left: 1.5rem;">
                                ${job.responsibilities.map(resp => `<li>${resp}</li>`).join('')}
                            </ul>
                        ` : ''}
                        <button class="apply-btn" onclick="applyToJob('${job._id}', '${job.title}')" style="margin-top: 1rem;">Apply Now</button>
                    </div>
                </div>
            `).join('');
        }

        async function applyToJob(jobId, jobTitle) {
            if (!token || user.userType !== 'employee') {
                alert('Please login as employee to apply for jobs');
                window.location.href = 'employee-login.html';
                return;
            }
            
            window.location.href = `employee-apply-job.html?jobId=${jobId}`;
        }

        function searchJobs() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filtered = allJobs.filter(job => 
                job.title.toLowerCase().includes(searchTerm) ||
                job.company.toLowerCase().includes(searchTerm) ||
                job.description.toLowerCase().includes(searchTerm) ||
                (job.skills && job.skills.some(skill => skill.toLowerCase().includes(searchTerm)))
            );
            displayJobs(filtered);
        }

        function applyFilters() {
            const location = document.getElementById('locationFilter').value;
            const type = document.getElementById('typeFilter').value;
            const experience = document.getElementById('experienceFilter').value;

            let filtered = allJobs;

            if (location) {
                filtered = filtered.filter(job => job.workplaceType === location);
            }
            if (type) {
                filtered = filtered.filter(job => job.employmentType === type);
            }
            if (experience) {
                filtered = filtered.filter(job => job.experienceLevel === experience);
            }

            displayJobs(filtered);
        }

        function formatEmploymentType(type) {
            const typeMap = {
                'full-time': 'Full-time',
                'part-time': 'Part-time',
                'contract': 'Contract',
                'internship': 'Internship',
                'temporary': 'Temporary'
            };
            return typeMap[type] || type;
        }

        function formatExperienceLevel(level) {
            const levelMap = {
                'entry-level': 'Entry Level',
                'associate': 'Associate',
                'mid-senior': 'Mid-Senior',
                'director': 'Director',
                'executive': 'Executive'
            };
            return levelMap[level] || level;
        }

        function formatWorkplaceType(type) {
            const typeMap = {
                'remote': 'Remote',
                'on-site': 'On-site',
                'hybrid': 'Hybrid'
            };
            return typeMap[type] || type;
        }

        function truncateText(text, maxLength) {
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '...';
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) return 'today';
            if (diffDays === 1) return 'yesterday';
            if (diffDays < 7) return `${diffDays} days ago`;
            if (diffDays < 30) return `${Math.floor(diffDays / 7)} weeks ago`;
            
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }
    </script>
</body>
</html>